<!DOCTYPE html>
<!-- cse6242 -->

<!-- run: http-server & -->

<head>
  <meta charset="utf-8" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .axis path, .axis line { shape-rendering: crispEdges; stroke: #888; }
  </style>
  <title>Wildlife Trafficking Incidents per Species (2015 to 2023)</title>
</head>

<body>

  <script src="lib/d3/d3.min.js"></script>
  <script src="lib/d3-dsv/d3-dsv.min.js"></script>
  <script src="lib/d3-fetch/d3-fetch.min.js"></script>

  <script>
    // define the dimensions and margins for the graph
    var margin = { top: 60, right: 24, bottom: 64, left: 220 };
    var width  = 800 - margin.left - margin.right;
    var height = 360 - margin.top - margin.bottom;

    // create scales x & y for X and Y axis and set their ranges
    var x = d3.scaleLinear().range([0, width]);            // linear scale (req. #5)
    var y = d3.scaleBand().range([0, height]).padding(0.2); // categorical scale (req. #6)

    // a colorblind-safe palette (req. #9 â€“ unique color per bar)
    var color = d3.scaleOrdinal()
      .range(["#0072B2", "#E69F00", "#009E73", "#CC79A7", "#D55E00"]);

    // append svg element to the body of the page
    var svg = d3.select("body").append("svg")
      // set the id, dimensions and position of the svg element
      .attr("width",  width  + margin.left + margin.right)
      .attr("height", height + margin.top  + margin.bottom)
      .append("g")
      .attr("id", "container")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // Get the data and filter for top 5 most trafficked species
    var pathToCsv = "q3.csv";    // path to csv

    d3.dsv(",", pathToCsv, function (d) {
      return {
        // format data attributes if required
        species: d.species,
        count: +d.count
      }
    }).then(function (data) {
      console.log(data); // you should see the data in your browser's developer tools console

      /* Create bar plot using data from csv */

      // keep valid rows, sort desc by count, take top 5 (req. #6)
      data = data
        .filter(function (d) { return d.species && Number.isFinite(d.count); })
        .sort(function (a, b) { return d3.descending(a.count, b.count); })
        .slice(0, 5);

      // set the domains of X and Y scales based on data (must not be hard-coded; req. #3)
      var maxCount = d3.max(data, function (d) { return d.count; });
      var maxRounded = Math.ceil(maxCount / 500) * 500;          // for 500-interval ticks (req. #5)
      x.domain([0, maxRounded]);
      y.domain(data.map(function (d) { return d.species; }));
      color.domain(y.domain());

      // Add bars to svg - create new elements based on your data (equal thickness + spacing; req. #2)
      svg.selectAll(".bar")
        .data(data)
        .enter()
        .append("rect")
          .attr("class", "bar")
          .attr("x", 0)
          .attr("y", function (d) { return y(d.species); })
          .attr("height", y.bandwidth())
          .attr("width", function (d) { return x(d.count); })
          .attr("fill", function (d) { return color(d.species); });

      // Add the X Axis (below plot; req. #3 & #5) with ticks every 500
      var xTicks = d3.range(0, maxRounded + 1, 500);
      svg.append("g")
        .attr("id", "x_axis")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).tickValues(xTicks).tickFormat(d3.format("d")));

      // Add the text label for X Axis (req. #4)
      svg.append("text")
        .attr("id", "x_axis_label")
        .attr("x", width / 2)
        .attr("y", height + 44)
        .attr("text-anchor", "middle")
        .text("Count");

      // Add the Y Axis (left of plot; req. #3 & #6)
      svg.append("g")
        .attr("id", "y_axis")
        .attr("class", "axis")
        .call(d3.axisLeft(y));

      // Add the text label for Y axis (req. #4)
      svg.append("text")
        .attr("id", "y_axis_label")
        .attr("x", -margin.left + 10)
        .attr("y", -24)
        .attr("text-anchor", "start")
        .text("Species");

      // Add Title (independent from HTML <title>; req. #7)
      svg.append("text")
        .attr("id", "title")
        .attr("x", 0)
        .attr("y", -32)
        .attr("text-anchor", "start")
        .style("font-weight", "600")
        .text("Wildlife Trafficking Incidents per Species (2015 to 2023)");

      // Add GT username (bottom-right beneath plot; req. #8)
      svg.append("text")
        .attr("id", "credit")
        .attr("x", width)
        .attr("y", height + 44)
        .attr("text-anchor", "end")
        .text("jyap36");

    }).catch(function (error) {
      console.log(error);
    });

  </script>
</body>