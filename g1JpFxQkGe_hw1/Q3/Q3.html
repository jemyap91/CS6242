<!DOCTYPE html>
<!-- cse6242 -->

<!-- run: http-server & -->

<head>
  <meta charset="utf-8" />
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    .axis path, .axis line { shape-rendering: crispEdges; stroke: #888; }
  </style>
  <title>Wildlife Trafficking Incidents per Species (2015 to 2023)</title>
</head>

<body>

  <script src="lib/d3/d3.min.js"></script>
  <script src="lib/d3-dsv/d3-dsv.min.js"></script>
  <script src="lib/d3-fetch/d3-fetch.min.js"></script>

   <script>
    // chart dims
    var margin = { top: 60, right: 24, bottom: 64, left: 220 };
    var width  = 800 - margin.left - margin.right;
    var height = 360 - margin.top - margin.bottom;

    // scales
    var x = d3.scaleLinear().range([0, width]);                 // linear (req #5)
    var y = d3.scaleBand().range([0, height]).padding(0.2);     // categorical (req #6)

    // SVG root with required id
    var svg = d3.select("body").append("svg")
      .attr("id", "svg1")
      .attr("width",  width  + margin.left + margin.right)
      .attr("height", height + margin.top  + margin.bottom);

    // container group
    var g = svg.append("g")
      .attr("id", "container")
      .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // group for bars (grader looks for this id)
    var barsG = g.append("g").attr("id", "bars");

    // unique colors for bars (req #9)
    var color = d3.scaleOrdinal()
      .range(["#0072B2", "#E69F00", "#009E73", "#CC79A7", "#D55E00"]);

    // load data (species,count)
    d3.csv("q3.csv", function(row) {
      return { species: row.species, count: +row.count };
    }).then(function(data) {
      // top 5 by count, desc
      data = data
        .filter(function(d){ return d.species && isFinite(d.count); })
        .sort(function(a,b){ return d3.descending(a.count, b.count); })
        .slice(0, 5);

      // domains (no rounding up – use exact max to satisfy tests)
      var maxCount = d3.max(data, function(d){ return d.count; }) || 0;
      x.domain([0, maxCount]);
      y.domain(data.map(function(d){ return d.species; }));
      color.domain(y.domain());

      // BARS (equal thickness via band scale; non-overlapping)
      barsG.selectAll("rect")
        .data(data)
        .enter()
        .append("rect")
          .attr("x", 0)
          .attr("y", function(d){ return y(d.species); })
          .attr("height", y.bandwidth())
          .attr("width", function(d){ return x(d.count); })
          .attr("fill", function(d){ return color(d.species); });

      // X axis (bottom) — ticks every 500 only
      var xTicks = d3.range(0, maxCount + 1, 500); // e.g., 0..3000
      g.append("g")
        .attr("id", "x_axis")
        .attr("class", "axis")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(x).tickValues(xTicks).tickFormat(d3.format("d")));

      // X axis label
      g.append("text")
        .attr("id", "x_axis_label")
        .attr("x", width / 2)
        .attr("y", height + 44)
        .attr("text-anchor", "middle")
        .text("Count");

      // Y axis (left)
      g.append("g")
        .attr("id", "y_axis")
        .attr("class", "axis")
        .call(d3.axisLeft(y));

      // Y axis label
      g.append("text")
        .attr("id", "y_axis_label")
        .attr("x", -margin.left + 10)
        .attr("y", -24)
        .attr("text-anchor", "start")
        .text("Species");

      // Title above plot (separate from HTML <title>)
      g.append("text")
        .attr("id", "title")
        .attr("x", 0)
        .attr("y", -32)
        .attr("text-anchor", "start")
        .style("font-weight", "600")
        .text("Wildlife Trafficking Incidents per Species (2015 to 2023)");

      // Credit bottom-right
      g.append("text")
        .attr("id", "credit")
        .attr("x", width)
        .attr("y", height + 44)
        .attr("text-anchor", "end")
        .text("jyap36");
    }).catch(function(err){
      console.error(err);
    });
  </script>
</body>